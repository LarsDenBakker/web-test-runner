<html>
  <body>
    <script type="module">
      import { runTests } from "web-test-runner";

      function addElement(tag, props = {}, parent = document.body) {
        return parent.appendChild(
          Object.assign(document.createElement(tag), props)
        );
      }

      (async () => {
        const params = new URLSearchParams(window.location.search);
        const testFile = params.get("file");
        if (testFile) {
          // single test run
          addElement("h1", { href: "/", textContent: testFile });
          addElement("a", { href: "/", textContent: "<- Back" });
          addElement("p", {
            href: "/",
            textContent:
              "HTML reporting is still being worked on. For now you can see test results browser and node console.",
          });

          await import(testFile);
          runTests();
        } else {
          // choose which test to run
          const testFiles = await (await fetch("/wtr/test-files")).json();
          if (testFiles.length === 1) {
            window.location.href = `?file=${testFiles[0]}`;
            return;
          }

          addElement("h1", { href: "/", textContent: "Choose a test file" });
          const ul = addElement("ul");
          for (const testFile of testFiles) {
            addElement(
              "a",
              { href: `?file=${testFile}`, textContent: testFile },
              addElement("li", {}, ul)
            );
          }
        }
      })();
    </script>
  </body>
</html>
